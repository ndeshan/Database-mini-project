CREATE VIEW pending_medical_records AS
SELECT 
    m.Medical_Id,
    m.ST_Id,
    s.Fname,
    s.Lname,
    s.Department,
    m.Course_code,
    m.Date_Submit,
    m.Valid_From,
    m.Valid_To,
    u.Fname AS Approver_Fname,
    u.Lname AS Approver_Lname
FROM medical_record m
JOIN student s ON m.ST_Id = s.Registration_No
LEFT JOIN user u ON m.Approved_By = u.U_Id
WHERE m.Approve = 0;

CREATE VIEW approved_medical_records AS
SELECT 
    m.Medical_Id,
    m.ST_Id,
    s.Fname,
    s.Lname,
    s.Department AS Student_Department,
    m.Course_code,
    m.Date_Submit,
    m.Valid_From,
    m.Valid_To,
    m.Approve,
    m.Approved_By
FROM medical_record m
JOIN student s ON m.ST_Id = s.Registration_No
WHERE m.Approve = 1;



CREATE VIEW student_full_info AS
SELECT 
    s.Registration_No,
    s.Fname,
    s.Lname,
    s.Year,
    s.Department AS Student_Department,
    s.Batch,
    
    u.Email,
    u.Address,
    u.Gender,
    u.Dob,
    uc.Contact_No
FROM student s
JOIN user u ON s.Registration_No = u.U_Id
LEFT JOIN user_contact uc ON u.U_Id = uc.U_Id;














DELIMITER //
CREATE PROCEDURE AddStudent(
    IN p_U_Id VARCHAR(20),
    IN p_Fname VARCHAR(45),
    IN p_Lname VARCHAR(45),
    IN p_Email VARCHAR(45),
    IN p_Address VARCHAR(45),
    IN p_Gender VARCHAR(10),
    IN p_Dob DATE,
    IN p_Department VARCHAR(45),
    IN p_Year INT,
    IN p_Batch INT
    )
BEGIN
    
    
    INSERT INTO user (U_Id, Fname, Lname, Email, Address, Gender, Dob, Role, Department)
    VALUES (p_U_Id, p_Fname, p_Lname, p_Email, p_Address, p_Gender, p_Dob, 'Student', p_Department);

    INSERT INTO student (Registration_No, Fname, Lname, Year, Department, Batch)
    VALUES (p_U_Id, p_Fname, p_Lname, p_Year, p_Department, p_Batch);

    
END //
DELIMITER ;