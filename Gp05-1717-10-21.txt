UPDATE course_enrollment 
SET Official_Confirmation = 'REPEAT' 
WHERE Official_Confirmation = 'CANCEL';













DELIMITER //

CREATE PROCEDURE exam_enrollment_all()
BEGIN

    UPDATE exam_enrollment e
    INNER JOIN attendance_summary a 
        ON e.ST_Id = a.ST_Id 
        AND e.Course_code = a.Course_code
    SET e.Attendance_Eligible = 1
    WHERE a.Eligibility = 'Eligible';

        UPDATE exam_enrollment e
    LEFT JOIN attendance_summary a 
        ON e.ST_Id = a.ST_Id 
        AND e.Course_code = a.Course_code
    SET e.Attendance_Eligible = 0
    WHERE a.Eligibility IS NULL OR a.Eligibility != 'Eligible';


    UPDATE exam_enrollment e
    INNER JOIN student_result r 
        ON e.ST_Id = r.student_id 
        AND e.Course_code = r.course_code
    SET e.CA_Eligible = 
        CASE 
            WHEN r.CA_Marks > 20 THEN 1            
            ELSE 0                        
        END;

    UPDATE exam_enrollment e
    LEFT JOIN student_result r 
        ON e.ST_Id = r.student_id 
        AND e.Course_code = r.course_code
    SET e.CA_Eligible = 0
    WHERE r.student_id IS NULL;


   
    UPDATE exam_enrollment e
    SET e.Final_Eligible = 
        CASE 
            WHEN e.Attendance_Eligible = 1 AND e.CA_Eligible = 1 THEN 1
            ELSE 0
        END;
END//

DELIMITER ;




call exam_enrollment_all();
